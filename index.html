<!DOCTYPE html>
<html>
<head>
    <title>Seminar Sage</title>
    <link href="https://fonts.googleapis.com/css2?family=Mulish&display=swap" rel="stylesheet">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #voiceflow-container {
            border: none; /* Remove iframe border if desired */
            width: 100vw;  /* Full viewport width */
            height: 100vh; /* Full viewport height */
            position: fixed;
            top: 0;
            left: 0;
            font-family: 'Mulish', sans-serif !important;
        }
    </style>
</head>
<body>
    <div id="voiceflow-container"></div>
    <script type="text/javascript">
      (function(d, t) {
          var v = d.createElement(t), s = d.getElementsByTagName(t)[0];
          v.onload = function() {
            window.voiceflow.chat.load({
              verify: { projectID: '67e57c8960fe7e4d365d966a' },
              url: 'https://general-runtime.voiceflow.com',
              versionID: 'production',
              voice: {
                url: "https://runtime-api.voiceflow.com"
             },
       	 assistant: {
             stylesheet: "data:text/css;base64, LyogSDEgKi8KLyogLnZmcmMtc3lzdGVtLXJlc3BvbnNlIC52ZnJjLW1lc3NhZ2UgaDEgewogIGZvbnQtc2l6ZTogMjZweDsKICBmb250LXdlaWdodDogNzAwOwogIG1hcmdpbjogMTZweCAwIDhweDsKICBjb2xvcjogIzFBMUExQTsKfSAqLwoKCiovIEgyICovCi8qIC52ZnJjLXN5c3RlbS1yZXNwb25zZSAudmZyYy1tZXNzYWdlIGgyIHsKICBmb250LXNpemU6IDIycHg7CiAgZm9udC13ZWlnaHQ6IDcwMDsKICBtYXJnaW46IDE0cHggMCA2cHg7CiAgY29sb3I6ICMzMzMzMzM7Cn0gKi8KCgovKiBIMyAqLwovKiAudmZyYy1zeXN0ZW0tcmVzcG9uc2UgLnZmcmMtbWVzc2FnZSBoMyB7CiAgZm9udC1zaXplOiAxOHB4OwogIGZvbnQtd2VpZ2h0OiA2MDA7CiAgbWFyZ2luOiAxMnB4IDAgNHB4OwogIGNvbG9yOiAjNDQ0NDQ0Owp9ICovCgoKLyouIEg0ICovCi8qIC52ZnJjLXN5c3RlbS1yZXNwb25zZSAudmZyYy1tZXNzYWdlIGg0IHsKICBmb250LXNpemU6IDE2cHg7CiAgZm9udC13ZWlnaHQ6IDYwMDsKICBtYXJnaW46IDEwcHggMCAycHg7CiAgY29sb3I6ICM1NTU1NTU7Cn0gKi8K", 
        	 extensions: [FileUploadExtension]
     	 },
              render: {
                mode: 'embedded',
                target: document.getElementById('voiceflow-container')
              }
            });
          }
          v.src = "https://cdn.voiceflow.com/widget-next/bundle.mjs"; v.type = "text/javascript"; s.parentNode.insertBefore(v, s);
    // ðŸ“¦ Define the FileUploadExtension
        const FileUploadExtension = {
          name: 'FileUpload',
          type: 'response',
          match: ({ trace }) =>
            trace.type === 'ext_csvFileUpload' ||
            trace.payload?.name === 'ext_csvFileUpload',
    
          render: ({ trace, element }) => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = trace.payload.accepted || '*/*';
            input.multiple = true;
    
            input.onchange = () => {
              const files = Array.from(input.files || []);
              const MAX_SIZE = 3 * 1024 * 1024; // 3 MB
    
              const validFiles = files.filter(file => {
                if (file.size > MAX_SIZE) {
                  alert(`File "${file.name}" is too large. Max size is 3MB.`);
                  return false;
                }
                return true;
              });
    
              if (validFiles.length === 0) return;
    
              const fileReadPromises = validFiles.map(file => {
                return new Promise((resolve, reject) => {
                  const reader = new FileReader();
                  reader.onload = () => {
                    try {
                      const base64 = reader.result.split(',')[1];
                      resolve({
                        fileName: file.name,
                        fileType: file.type,
                        fileData: atob(base64)
                      });
                    } catch (err) {
                      reject(err);
                    }
                  };
                  reader.onerror = reject;
                  reader.readAsDataURL(file);
                });
              });
    
              Promise.all(fileReadPromises)
                .then(filePayloads => {
                  window.voiceflow.chat.interact({
                    type: 'complete',
                    payload: { files: filePayloads }
                  });
                })
                .catch(err => {
                  alert("Error reading one or more files.");
                  console.error(err);
                });
            };
    
            element.appendChild(input);
          }
        };
      })(document, 'script');
</script>
</body>
</html>
